
-- EXECUTE ESTE SCRIPT NO SQL EDITOR DO SEU SUPABASE DASHBOARD --

-- 1. Tabela de Perfis (Armazena Nickname e ID)
CREATE TABLE IF NOT EXISTS public.profiles (
    id TEXT PRIMARY KEY, -- ID Único do Operador
    name TEXT NOT NULL, -- Nickname (Nome)
    last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. Tabela de Amizades (Relacionamento entre Operadores)
CREATE TABLE IF NOT EXISTS public.friendships (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id TEXT REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
    friend_id TEXT REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, friend_id)
);

-- 3. Habilitar Realtime para atualizações ao vivo (Opcional)
ALTER PUBLICATION supabase_realtime ADD TABLE profiles;
ALTER PUBLICATION supabase_realtime ADD TABLE friendships;

-- 4. Políticas de Segurança (RLS) - Permite que qualquer um leia/escreva para o quiz
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.friendships ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Acesso público perfis" ON public.profiles FOR ALL USING (true) WITH CHECK (true);
CREATE POLICY "Acesso público amizades" ON public.friendships FOR ALL USING (true) WITH CHECK (true);
